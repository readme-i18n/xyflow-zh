---

description: '该钩子可用于订阅 React Flow 组件的内部状态变更。useStore 钩子是从 Zustand 状态管理库重新导出的，建议查阅其文档获取更多细节。'
---

import { Callout } from 'nextra/components';

# useStore()

[GitHub 源码](https://github.com/xyflow/xyflow/blob/main/packages/react/src/hooks/useStore.ts)

该钩子可用于订阅 React Flow 组件的内部状态变更。`useStore` 钩子是从 [Zustand](https://github.com/pmndrs/zustand) 状态管理库重新导出的，建议查阅其文档获取更多细节。

<Callout type="info">
  仅当无法通过其他方式访问内部状态时才应使用此钩子。对于大多数常见用例，我们提供了专用钩子如 [`useReactFlow`](/api-reference/hooks/use-react-flow)、[`useViewport`](/api-reference/hooks/use-viewport) 等。
</Callout>

```jsx
import { ReactFlow, useStore } from '@xyflow/react';

const nodesLengthSelector = (state) =>
  state.nodes.length || 0;

const NodesLengthDisplay = () => {
  const nodesLength = useStore(nodesLengthSelector);

  return <div>The current number of nodes is: {nodesLength}</div>;
};

function Flow() {
  return (
    <ReactFlow nodes={[...]}>
      <NodesLengthDisplay />
    </ReactFlow>
  );
}
```

此示例会实时计算节点数量。当流程中的节点数量发生变化时，`<NodesLengthDisplay />` 组件将重新渲染。这与 [`useStoreApi`](/api-reference/hooks/use-store-api) 钩子中的示例形成对比，后者仅在按钮点击时计算节点数量。

选择按需计算值还是订阅变更事件需要权衡考量。一方面，在事件处理程序中执行过多繁重计算可能导致应用响应迟缓；另一方面，过早计算值可能引发不必要的重复渲染或性能下降。

我们同时提供此钩子和 [`useStoreApi`](/api-reference/hooks/use-store-api)，以便您根据实际用例选择最适合的方案。

## 签名

<APIDocs functionName="useStore" />

## 使用示例

### 触发存储操作

你可以通过 `useStore` 钩子触发内部操作来操控 React Flow 的内部状态。这些操作在库内部已广泛使用，但你也可以利用它们实现自定义功能。

```jsx
import { useStore } from '@xyflow/react';

const setMinZoomSelector = (state) => state.setMinZoom;

function MinZoomSetter() {
  const setMinZoom = useStore(setMinZoomSelector);

  return <button onClick={() => setMinZoom(6)}>set min zoom</button>;
}
```

## TypeScript

该钩子可以通过类型化选择器函数进行类型定义。更多信息请参阅[TypeScript指南中的相关章节](/learn/advanced-use/typescript#nodetype-edgetype-unions)。

```tsx
const nodes = useStore((s: ReactFlowState<CustomNodeType>) => ({
  nodes: s.nodes,
}));
```

## 注意事项

- 你应当在组件外部定义存储选择器函数，或使用 React 的 `useCallback` 钩子来记忆化该函数。若不这样做可能会导致轻微的性能损失。