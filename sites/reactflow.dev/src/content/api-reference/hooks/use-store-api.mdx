---

description: '在某些情况下，您可能需要直接访问存储。该钩子返回可按需使用的存储对象，用于访问状态或派发操作。'
---

# useStoreApi()

[GitHub 源码](https://github.com/xyflow/xyflow/blob/main/packages/react/src/hooks/useStore.ts)

某些情况下，您可能需要直接访问存储。该钩子返回可按需使用的存储对象，用于访问状态或派发操作。

> [!NOTE]
>
> 仅当没有其他方式访问内部状态时，才应使用此钩子。对于大多数常见用例，已有专用钩子可用，例如 [`useReactFlow`](/api-reference/hooks/use-react-flow)、[`useViewport`](/api-reference/hooks/use-viewport) 等。

```tsx
import { useState, useCallback } from 'react';
import { ReactFlow, useStoreApi } from '@xyflow/react';

const NodesLengthDisplay = () => {
  const [nodesLength, setNodesLength] = useState(0);
  const store = useStoreApi();

  const onClick = useCallback(() => {
    const { nodes } = store.getState();
    const length = nodes.length || 0;

    setNodesLength(length);
  }, [store]);

  return (
    <div>
      <p>The current number of nodes is: {nodesLength}</p>
      <button onClick={onClick}>Update node length.</button>
    </div>
  );
};

function Flow() {
  return (
    <ReactFlow nodes={nodes}>
      <NodesLengthLogger />
    </ReactFlow>
  );
}
```

此示例演示了如何_按需_计算流程中的节点数量。这与 [`useStore`](/api-reference/hooks/use-store) 钩子中的示例形成对比，后者会在节点数量变化时重新渲染组件。

选择按需计算值还是订阅变更事件需要权衡考量。一方面，在事件处理程序中执行过多繁重计算可能导致应用响应迟缓；另一方面，过早计算值可能引发不必要的重复渲染或性能下降。

我们同时提供这个钩子函数和 [`useStore`](/api-reference/hooks/use-store)，以便您可以根据实际使用场景选择最适合的方案。

## 签名

<APIDocs functionName="useStoreApi" />

## TypeScript

此钩子接受自定义节点和边类型的泛型参数。详见 [TypeScript 指南](/learn/advanced-use/typescript#nodetype-edgetype-unions) 中的相关章节。

```tsx
const store = useStoreApi<CustomNodeType, CustomEdgeType>();
```