---

sidebarTitle: Devtools
description: 可复用的 React Flow 开发工具
---

import { Callout } from 'nextra/components';
import { RemoteCodeViewer } from 'xy-shared/server';

# 开发工具与调试

<Callout type="info">
  这是我们正在实验的 React Flow 专属开发工具。在正式封装成包之前，欢迎通过
  [Discord](https://discord.gg/Bqt6xrs) 或邮件 info@xyflow.com 分享您的反馈与建议。
</Callout>

React Flow 看似一个神秘的黑盒，但实际上只要掌握方法，就能揭示其内部状态。本指南将展示三种调试方案：

- `<ViewportLogger />` 组件：显示视口的当前位置与缩放级别
- `<NodeInspector />` 组件：揭示每个节点的状态
- `<ChangeLogger />` 组件：包裹 flow 的 `onNodesChange` 处理器，实时记录每次变更

这些工具不仅能验证 React Flow 运行状态，当您的流程图交互日趋复杂时，它们也是调试应用的利器。

<div className="nestedSandpack">
  <RemoteCodeViewer route="learn/devtools" framework="react" />
</div>

您可以直接复制本示例中的任意组件到项目中，按需修改即可独立使用！

## 节点检查器

`<NodeInspector />` 组件利用我们的 [`useNodes`](/api-reference/hooks/use-nodes) 钩子来访问流程中的所有节点。通常我们不推荐使用此钩子，因为它会在_任何_节点发生变化时触发重新渲染，但这恰恰使其成为调试的利器！

`width` 和 `height` 属性由 React Flow 在测量节点尺寸后自动添加到每个节点上。我们将这些尺寸信息连同节点 ID 和类型等其他数据传递给自定义的 `<NodeInfo />` 组件。

我们使用 [`<ViewportPortal />`](/api-reference/components/viewport-portal) 组件将检查器渲染到 React Flow 的视口中。这意味着其内容会随用户平移和缩放操作，与流程图的其余部分同步进行位置变换。

## 变更记录器

React Flow 本身触发的所有节点和边变更都会通过 `onNodesChange` 和 `onEdgesChange` 回调通知您。如果您正在处理受控流程图（即自行管理节点和边），则需将这些变更应用到状态中以保持同步。

`<ChangeLogger />` 组件通过自定义函数封装用户提供的 `onNodesChange` 处理程序，在每次变更派发时拦截并记录日志。我们可以利用 [`useStore`](/api-reference/hooks/use-store) 和 [`useStoreApi`](/api-reference/hooks/use-store-api) 钩子访问存储，并相应地更新 React Flow 的内部状态。这两个钩子为您提供了强大的能力来访问 React Flow 的内部状态和方法。

除调试用途外，使用 `<ChangeLogger />` 也是深入了解 React Flow 运行机制的绝佳方式，它能启发您思考如何基于每次变更构建不同的功能。

您可以在 API 参考文档中查阅 [`NodeChange`](/api-reference/types/node-change) 和 [`EdgeChange`](/api-reference/types/edge-change) 类型的详细说明。

## 视口记录器

`<ViewportLogger />` 是展示如何从 React Flow 存储中提取状态的最简单示例。视口状态在内部存储在 `transform` 键下（此命名继承自 [d3-zoom](https://d3js.org/d3-zoom#zoomTransform)）。该组件提取变换的 `x`、`y` 和 `zoom` 分量，并将其渲染到 [`<Panel />`](/api-reference/components/panel) 组件中。

## 反馈建议

如之前所述，如果您对改进开发者工具有任何反馈或想法，
欢迎通过 [Discord](https://discord.gg/Bqt6xrs) 或邮件 info@xyflow.com 联系我们。如果您基于这些思路构建了自己的开发者工具，我们非常期待了解您的成果！