---

description: 如何使用 Cypress、Playwright 或 Jest 测试 React Flow 应用
---

# 测试

测试 React 应用有多种选择。若需测试 React Flow 应用，我们推荐使用 [Cypress](https://www.cypress.io/) 或 [Playwright](https://playwright.dev/)。React Flow 需要测量节点才能渲染边，这依赖于 DOM 元素的渲染。

## 使用 Cypress 或 Playwright

若使用 Cypress 或 Playwright 则无需额外配置。可参考 [Cypress 入门指南](https://docs.cypress.io/guides/getting-started/installing-cypress) 和 [Playwright 文档](https://playwright.dev/docs/intro)。

## 使用 Jest

若使用 [Jest](https://jestjs.io/)，需模拟部分功能才能运行测试。可通过将此文件添加到项目中实现。在 `setupTests` 文件（或 `beforeEach` 内）调用 `mockReactFlow()` 将触发必要的覆盖。

```ts
// To make sure that the tests are working, it's important that you are using
// this implementation of ResizeObserver and DOMMatrixReadOnly
class ResizeObserver {
  callback: globalThis.ResizeObserverCallback;

  constructor(callback: globalThis.ResizeObserverCallback) {
    this.callback = callback;
  }

  observe(target: Element) {
    this.callback([{ target } as globalThis.ResizeObserverEntry], this);
  }

  unobserve() {}

  disconnect() {}
}

class DOMMatrixReadOnly {
  m22: number;
  constructor(transform: string) {
    const scale = transform?.match(/scale\(([1-9.])\)/)?.[1];
    this.m22 = scale !== undefined ? +scale : 1;
  }
}

// Only run the shim once when requested
let init = false;

export const mockReactFlow = () => {
  if (init) return;
  init = true;

  global.ResizeObserver = ResizeObserver;

  // @ts-ignore
  global.DOMMatrixReadOnly = DOMMatrixReadOnly;

  Object.defineProperties(global.HTMLElement.prototype, {
    offsetHeight: {
      get() {
        return parseFloat(this.style.height) || 1;
      },
    },
    offsetWidth: {
      get() {
        return parseFloat(this.style.width) || 1;
      },
    },
  });

  (global.SVGElement as any).prototype.getBBox = () => ({
    x: 0,
    y: 0,
    width: 0,
    height: 0,
  });
};
```

如需用 Jest 测试鼠标事件（例如在自定义节点内），需禁用 `d3-drag`，因其在浏览器外无法工作：

```js
<ReactFlow nodesDraggable={false} panOnDrag={false} {...rest} />
```