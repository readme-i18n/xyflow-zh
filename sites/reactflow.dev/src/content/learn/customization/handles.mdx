---

description: 本指南展示如何在 React Flow 的自定义节点中添加连接手柄。
---

import { RemoteCodeViewer } from 'xy-shared/server';
import { Callout } from 'nextra/components';

# 连接手柄

连接手柄是 React Flow 中
[节点](/learn/concepts/terms-and-definitions#nodes)上的连接点。我们内置的
节点包含一个源手柄和一个目标手柄，但您可以根据需要为自定义节点配置任意数量的不同手柄。

## 创建带手柄的节点

要为[自定义节点](/learn/customization/custom-nodes)添加手柄，可以使用
React Flow 提供的 [`<Handle />`](/api-reference/components/handle) 组件。
该组件允许您为自定义节点定义源手柄和目标手柄。以下是一个实现带两个手柄的自定义节点示例：

```jsx {7-8}
import { Handle } from '@xyflow/react';

export function CustomNode() {
  return (
    <div className="custom-node">
      <div>Custom Node Content</div>
      <Handle type="source" position="top" />
      <Handle type="target" position="bottom" />
    </div>
  );
}
```

## 使用多个手柄

若要在自定义节点中使用多个源手柄或目标手柄，必须为每个手柄指定唯一的 `id`。
这样 React Flow 在连接边时才能区分不同手柄。

```jsx /id="a"/ /id="b"/
  <Handle type="target" position="top" />
  <Handle type="source" position="right" id="a" />
  <Handle type="source" position="bottom" id="b" />
```

要将边连接到节点的特定手柄，需使用 `sourceHandle`（边的起点）
和 `targetHandle`（边的终点）属性。通过为 `sourceHandle` 或 `targetHandle` 
指定对应手柄的 `id`，可指示 React Flow 将边连接到该特定手柄，确保连接按预期建立。

```js "sourceHandle: 'a'" "sourceHandle: 'b'"
const initialEdges = [
  { id: 'n1-n2', source: 'n1', sourceHandle: 'a', target: 'n2' },
  { id: 'n1-n3', source: 'n1', sourceHandle: 'b', target: 'n3' },
];
```

在此情况下，源节点`n1`对应两个连接点，但连接点的`id`各不相同：一个来自`a`，另一个来自`b`。两条边的目标节点也不同：

<RemoteCodeViewer route="learn/custom-node-2" framework="react" />

## 自定义连接点

您可以通过封装[`<Handle />`](/api-reference/components/handle)组件来创建自定义连接点。此示例展示了一个仅当连接源匹配给定id时才允许建立连接的自定义连接点。

```jsx
import { Handle, Position } from '@xyflow/react';

export function TargetHandleWithValidation({ position, source }) {
  return (
    <Handle
      type="target"
      position={position}
      isValidConnection={(connection) => connection.source === source}
      onConnect={(params) => console.log('handle onConnect', params)}
      style={{ background: '#fff' }}
    />
  );
}
```

## 无类型连接点

如需创建无特定类型（源或目标）的连接点，可在`<ReactFlow />`组件中将[connectionMode](/api-reference/react-flow#connectionmode)设为`Loose`。这将允许该连接点同时用于输入和输出连接。

## 动态连接点

若需以编程方式更改自定义节点中连接点的位置或数量，需使用[`useUpdateNodeInternals`](/api-reference/hooks/use-update-node-internals)钩子更新节点内部状态。

## 自定义连接点样式

由于连接点本质是div元素，您可以使用CSS或传递style属性来定制样式。具体示例可参考[在边上拖拽添加节点](/examples/nodes/add-node-on-edge-drop)和[简单浮动边](/examples/edges/simple-floating-edges)。

### 连接时的样式处理

当连接线位于手柄上方时，手柄会获得额外的 `connecting` 类名；若连接有效则会添加 `valid` 类名。您可以在[此处](/examples/interaction/validation)查看使用这些类的示例。

### 隐藏手柄

如需隐藏手柄，必须使用 `visibility: hidden` 或 `opacity: 0` 而非 `display: none`。这一点至关重要，因为 React Flow 需要计算手柄的尺寸才能正常工作，而使用 `display: none` 会导致宽度和高度被报告为 `0`！