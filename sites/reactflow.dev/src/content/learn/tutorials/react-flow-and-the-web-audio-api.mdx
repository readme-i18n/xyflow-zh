---

sidebarTitle: Web Audio API
title: é›†æˆ React Flow ä¸ Web Audio API
intro: "ä»Šå¤©æˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨ React Flow å’Œ Web Audio API åˆ›å»ºä¸€ä¸ªäº¤äº’å¼éŸ³é¢‘å®éªŒåœºã€‚æˆ‘ä»¬å°†ä»é›¶å¼€å§‹ï¼Œå…ˆäº†è§£ Web Audio APIï¼Œå†ç ”ç©¶å¦‚ä½•å¤„ç† React Flow ä¸­çš„å¸¸è§åœºæ™¯ï¼šçŠ¶æ€ç®¡ç†ã€å®ç°è‡ªå®šä¹‰èŠ‚ç‚¹ä»¥åŠå¢åŠ äº¤äº’æ€§ã€‚"
date: 2023/04/14
authors: ['hayleigh']
tags: ['react-flow', 'web-audio-api', 'how-to']
image: /img/tutorials/webaudio/web-audio-blog-thumb.png
---

import { Emoji } from '@xyflow/xy-ui';
import { Callout, Tabs } from 'nextra/components';
import { Embed, Image } from 'xy-shared';
import { RemoteCodeViewer } from 'xy-shared/server';

ä»Šå¤©æˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨ React Flow å’Œ Web Audio API åˆ›å»ºä¸€ä¸ªäº¤äº’å¼éŸ³é¢‘å®éªŒåœºã€‚æˆ‘ä»¬å°†ä»é›¶å¼€å§‹ï¼Œå…ˆäº†è§£ Web Audio APIï¼Œå†ç ”ç©¶å¦‚ä½•å¤„ç† React Flow ä¸­çš„å¸¸è§åœºæ™¯ï¼šçŠ¶æ€ç®¡ç†ã€å®ç°è‡ªå®šä¹‰èŠ‚ç‚¹ä»¥åŠå¢åŠ äº¤äº’æ€§ã€‚

<Image
  src="/img/tutorials/webaudio/bleep-cafe.png"
  alt="A screenshot of bleep.cafe, a visual audio programming environment. In it,
    there are four nodes connected together: an xy pad, an oscillator node, a
    volume node, and a master output."
  wide
  caption="This is bleep.cafe. We're going to learn everything we need to know to
    build something just like it!"
/>

æ—©äº›æ—¶å€™ï¼Œæˆ‘åœ¨ React Flow çš„ [discord æœåŠ¡å™¨](https://discord.com/invite/RVmnytFmGW) åˆ†äº«äº†ä¸€ä¸ªæ­£åœ¨å¼€å‘çš„é¡¹ç›®ã€‚å®ƒå« [bleep.cafe](https://bleep.cafe)ï¼Œæ˜¯ä¸€ä¸ªå®Œå…¨åœ¨æµè§ˆå™¨ä¸­å­¦ä¹ æ•°å­—åˆæˆçš„è½»é‡çº§ç½‘é¡µåº”ç”¨ã€‚è®¸å¤šäººå¯¹è¿™ç±»é¡¹ç›®çš„æ„å»ºæ–¹å¼å¾ˆæ„Ÿå…´è¶£ï¼šå¤§å¤šæ•°äººç”šè‡³ä¸çŸ¥é“**æµè§ˆå™¨å†…ç½®äº†å®Œæ•´çš„åˆæˆå™¨å¼•æ“ï¼**

æœ¬æ•™ç¨‹å°†å¸¦é¢†æˆ‘ä»¬é€æ­¥æ„å»ºä¸€ä¸ªç±»ä¼¼çš„åŠŸèƒ½ã€‚è™½ç„¶å¯èƒ½ä¼šè·³è¿‡æŸäº›ç»†èŠ‚ï¼Œä½†å¦‚æœä½ æ˜¯ React Flow æˆ– Web Audio API çš„æ–°æ‰‹ï¼ŒåŸºæœ¬ä¸Šéƒ½èƒ½è·Ÿéšæ•™ç¨‹å¹¶åœ¨æœ€åå®Œæˆä¸€ä¸ªå¯è¿è¡Œçš„é¡¹ç›®ã€‚

å¦‚æœä½ å·²ç»æ˜¯ React Flow é«˜æ‰‹ï¼Œå¯ä»¥å…ˆé˜…è¯»å…³äº Web Audio API çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œç„¶åç›´æ¥è·³åˆ°ç¬¬ä¸‰èŠ‚äº†è§£å¦‚ä½•å°†å®ƒä»¬æ•´åˆèµ·æ¥ï¼

ä¸è¿‡é¦–å…ˆ...

## æ¼”ç¤ºç¤ºä¾‹ï¼

<Embed src="https://xyflow.github.io/react-flow-web-audio/" />

<Callout type="warning">
  æœ¬æ•™ç¨‹ä¸­çš„ç¤ºä¾‹ä¼šå‘å‡ºå£°éŸ³ã€‚ä¸ºé¿å…åˆ›ä½œå‡ºå‰å«è‰ºæœ¯ä½œå“ï¼Œè¯·è®°å¾—åœ¨æ¯ä¸ªç¤ºä¾‹ç»“æŸåå°†å…¶é™éŸ³ï¼
</Callout>

## Web Audio API

åœ¨æ·±å…¥ React Flow å’Œäº¤äº’å¼èŠ‚ç‚¹ç¼–è¾‘å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¿«é€Ÿäº†è§£ [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)ã€‚ä»¥ä¸‹æ˜¯éœ€è¦æŒæ¡çš„é‡ç‚¹ï¼š

- Web Audio API æä¾›äº†å¤šç§ä¸åŒçš„éŸ³é¢‘èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬ï¼š
  - éŸ³æºèŠ‚ç‚¹ï¼ˆå¦‚ [OscillatorNode](https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode)ã€
    [MediaElementAudioSourceNode](https://developer.mozilla.org/en-US/docs/Web/API/MediaElementAudioSourceNode)ï¼‰
  - æ•ˆæœèŠ‚ç‚¹ï¼ˆå¦‚ [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode)ã€
    [DelayNode](https://developer.mozilla.org/en-US/docs/Web/API/DelayNode)ã€
    [ConvolverNode](https://developer.mozilla.org/en-US/docs/Web/API/ConvolverNode)ï¼‰
  - è¾“å‡ºèŠ‚ç‚¹ï¼ˆå¦‚ [AudioDestinationNode](https://developer.mozilla.org/en-US/docs/Web/API/AudioDestinationNode)ï¼‰
- éŸ³é¢‘èŠ‚ç‚¹å¯ä»¥ç›¸äº’è¿æ¥å½¢æˆï¼ˆå¯èƒ½æ˜¯ç¯çŠ¶çš„ï¼‰å¤„ç†å›¾ï¼Œé€šå¸¸ç§°ä¸ºéŸ³é¢‘å¤„ç†å›¾ã€ä¿¡å·å›¾æˆ–ä¿¡å·é“¾
- éŸ³é¢‘å¤„ç†ç”±åŸç”Ÿä»£ç åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™æ„å‘³ç€å³ä½¿ä¸»UIçº¿ç¨‹ç¹å¿™æˆ–è¢«é˜»å¡ï¼Œä»å¯æŒç»­ç”Ÿæˆå£°éŸ³
- [AudioContext](https://developer.mozilla.org/en-US/docs/Web/API/AudioContext) ä½œä¸ºéŸ³é¢‘å¤„ç†å›¾çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œå¯ç”¨äºåˆ›å»ºæ–°éŸ³é¢‘èŠ‚ç‚¹ä»¥åŠå…¨å±€æš‚åœ/æ¢å¤éŸ³é¢‘å¤„ç†

### å£°éŸ³åˆæ¢

è®©æˆ‘ä»¬é€šè¿‡å®è·µæ¥æ„å»ºç¬¬ä¸€ä¸ª Web Audio åº”ç”¨ï¼è¿™æ¬¡ä¸ä¼šåšå¤ªå¤æ‚çš„åŠŸèƒ½ï¼šæˆ‘ä»¬å°†åˆ¶ä½œä¸€ä¸ªç®€æ˜“çš„é¼ æ ‡æ§åˆ¶[ç‰¹é›·é—¨ç´](http://www.thereminworld.com/Article/14232/what-s-a-theremin-)ã€‚æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¼šä½¿ç”¨ Reactï¼ˆæ¯•ç«Ÿæˆ‘ä»¬å« React Flow å˜›ï¼ï¼‰ä»¥åŠ [`vite`](https://vitejs.dev) æ¥å¤„ç†æ‰“åŒ…å’Œçƒ­æ›´æ–°ã€‚

å¦‚æœä½ åå¥½å…¶ä»–æ‰“åŒ…å·¥å…·å¦‚ parcel æˆ– Create React App ä¹Ÿæ²¡é—®é¢˜ï¼Œå®ƒä»¬åŠŸèƒ½å¤§åŒå°å¼‚ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹© TypeScript æ›¿ä»£ JavaScriptã€‚ä¸ºä¿æŒç®€æ´ä»Šå¤©æš‚ä¸ä½¿ç”¨ï¼Œä½† React Flow å®Œå…¨æ”¯æŒç±»å‹ï¼ˆä¸”å®Œå…¨ç”¨ TypeScript ç¼–å†™ï¼‰ï¼Œä½¿ç”¨èµ·æ¥éå¸¸é¡ºç•…ï¼

```bash npm2yarn
npm create vite@latest -- --template react
```

Vite ä¼šä¸ºæˆ‘ä»¬æ­å»ºåŸºç¡€ React åº”ç”¨ç»“æ„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ é™¤é»˜è®¤èµ„æºå¹¶è¿›å…¥ `App.jsx` å¼€å‘ã€‚ç§»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ¼”ç¤ºç»„ä»¶åï¼Œé¦–å…ˆåˆ›å»º AudioContext å¹¶ç»„è£…æ‰€éœ€èŠ‚ç‚¹ï¼šéœ€è¦ä¸€ä¸ª OscillatorNode æ¥ç”ŸæˆéŸ³è°ƒï¼Œä»¥åŠä¸€ä¸ª GainNode æ¥æ§åˆ¶éŸ³é‡ã€‚

```js filename="./src/App.jsx"
// Create the brain of our audio-processing graph
const context = new AudioContext();

// Create an oscillator node to generate tones
const osc = context.createOscillator();

// Create a gain node to control the volume
const amp = context.createGain();

// Pass the oscillator's output through the gain node and to our speakers
osc.connect(amp);
amp.connect(context.destination);

// Start generating those tones!
osc.start();
```

<Callout type="info">
æŒ¯è¡å™¨èŠ‚ç‚¹éœ€è¦æ‰‹åŠ¨å¯åŠ¨ã€‚

åˆ«å¿˜äº†è°ƒç”¨ `osc.start`ï¼Œå¦åˆ™æŒ¯è¡å™¨ä¸ä¼šå¼€å§‹å‘å£°ï¼

</Callout>

æœ¬åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å°†è¿½è¸ªé¼ æ ‡åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œå¹¶ç”¨å®ƒæ¥è®¾ç½®æŒ¯è¡å™¨èŠ‚ç‚¹çš„éŸ³é«˜å’Œå¢ç›ŠèŠ‚ç‚¹çš„éŸ³é‡ã€‚

```jsx filename="./src/App.jsx" {12-27}
import React from 'react';

const context = new AudioContext();
const osc = context.createOscillator();
const amp = context.createGain();

osc.connect(amp);
amp.connect(context.destination);

osc.start();

const updateValues = (e) => {
  const freq = (e.clientX / window.innerWidth) * 1000;
  const gain = e.clientY / window.innerHeight;

  osc.frequency.value = freq;
  amp.gain.value = gain;
};

export default function App() {
  return <div style={{ width: '100vw', height: '100vh' }} onMouseMove={updateValues} />;
}
```

<Callout type="info">
`osc.frequency.value`, `amp.gain.value`...

Web Audio API å¯¹æ™®é€šå¯¹è±¡å±æ€§å’ŒéŸ³é¢‘èŠ‚ç‚¹_å‚æ•°_è¿›è¡Œäº†æ˜ç¡®åŒºåˆ†ã€‚è¿™ç§åŒºåˆ†é€šè¿‡ `AudioParam` ç±»å‹ä½“ç°ã€‚ä½ å¯ä»¥åœ¨ [MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/AudioParam) ä¸­è¯¦ç»†äº†è§£ï¼Œç›®å‰åªéœ€çŸ¥é“ï¼šè®¾ç½® `AudioParam` çš„å€¼å¿…é¡»ä½¿ç”¨ `.value` å±æ€§ï¼Œè€Œä¸èƒ½ç›´æ¥èµ‹å€¼ã€‚

</Callout>

å¦‚æœç›´æ¥è¿è¡Œè¿™ä¸ªç¤ºä¾‹ï¼Œå¯èƒ½ä¼šå‘ç°æ²¡æœ‰ä»»ä½•ååº”ã€‚AudioContext é€šå¸¸ä¼šä»¥æš‚åœçŠ¶æ€å¯åŠ¨ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å¹¿å‘ŠåŠ«æŒæˆ‘ä»¬çš„æ‰¬å£°å™¨ã€‚æˆ‘ä»¬åªéœ€åœ¨ `<div />` ä¸Šæ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨ï¼Œå½“ä¸Šä¸‹æ–‡å¤„äºæš‚åœçŠ¶æ€æ—¶æ¢å¤å®ƒå³å¯è½»æ¾è§£å†³ã€‚

```jsx filename="./src/App.jsx" {1-7,12}
const toggleAudio = () => {
  if (context.state === 'suspended') {
    context.resume();
  } else {
    context.suspend();
  }
};

export default function App() {
  return (
    <div ...
      onClick={toggleAudio}
    />
  );
};
```

ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ Web Audio API åˆ¶ä½œå£°éŸ³æ‰€éœ€çš„å…¨éƒ¨åŸºç¡€ï¼ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œæ–¹ä¾¿ä½ å¯¹ç…§æŸ¥çœ‹ï¼š

<RemoteCodeViewer
  route="tutorials/webaudio/mouse-theremin"
  framework="react"
  
/>

ç°åœ¨è®©æˆ‘ä»¬æš‚æ—¶æç½®è¿™äº›çŸ¥è¯†ï¼Œæ¥çœ‹çœ‹å¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ª React Flow é¡¹ç›®ã€‚

<Callout type="info">
  å·²ç»æ˜¯ React Flow ä¸“å®¶ï¼Ÿå¦‚æœä½ å·²ç†Ÿæ‚‰ React Flowï¼Œå¯ä»¥è·³è¿‡ä¸‹ä¸€èŠ‚ç›´æ¥å‰å¾€ [åˆ¶ä½œå£°éŸ³](#do-sound-to-it)ã€‚å…¶ä»–ç”¨æˆ·è¯·è·Ÿéšæˆ‘ä»¬äº†è§£å¦‚ä½•ä»å¤´æ­å»º React Flow é¡¹ç›®ã€‚
</Callout>

## æ­å»º React Flow é¡¹ç›®è„šæ‰‹æ¶

ç¨åæˆ‘ä»¬å°†ç»“åˆæ‰€å­¦çš„ Web Audio APIã€æŒ¯è¡å™¨å’Œå¢ç›ŠèŠ‚ç‚¹çŸ¥è¯†ï¼Œä½¿ç”¨ React Flow äº¤äº’å¼æ„å»ºéŸ³é¢‘å¤„ç†å›¾ã€‚ä¸è¿‡ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ­å»ºä¸€ä¸ªç©ºçš„ React Flow åº”ç”¨æ¡†æ¶ã€‚

æˆ‘ä»¬å·²ç»é€šè¿‡ Vite æ­å»ºå¥½äº† React åº”ç”¨ï¼Œå› æ­¤ç»§ç»­æ²¿ç”¨è¯¥é…ç½®ã€‚å¦‚æœä½ è·³è¿‡äº†ä¸Šä¸€èŠ‚å†…å®¹ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡æ‰§è¡Œ `npm create vite@latest -- --template react` å‘½ä»¤åˆå§‹åŒ–çš„ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä»»æ„å–œæ¬¢çš„æ‰“åŒ…å·¥å…·æˆ–å¼€å‘æœåŠ¡å™¨ï¼Œè¿™é‡Œçš„å†…å®¹å¹¶ä¸ä¾èµ– Viteã€‚

æœ¬é¡¹ç›®ä»…éœ€æ·»åŠ ä¸‰ä¸ªé¢å¤–ä¾èµ–ï¼šç”¨äº UI çš„ `@xyflow/react`ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰ã€è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ `zustand`ï¼ˆReact Flow åº•å±‚ä½¿ç”¨ï¼‰ä»¥åŠ ID ç”Ÿæˆå·¥å…· `nanoid`ã€‚

```bash npm2yarn
npm install @xyflow/react zustand nanoid
```

æˆ‘ä»¬å°†æ¸…ç©ºä¹‹å‰ Web Audio é€Ÿæˆè¯¾çš„æ‰€æœ‰å†…å®¹ï¼Œä»å¤´å¼€å§‹ã€‚é¦–å…ˆæŒ‰ä»¥ä¸‹æ–¹å¼ä¿®æ”¹ `main.jsx`ï¼š

```jsx filename="./src/main.jsx"
import App from './App';
import React from 'react';
import ReactDOM from 'react-dom/client';
import { ReactFlowProvider } from '@xyflow/react';

// ğŸ‘‡ Don't forget to import the styles!
import '@xyflow/react/dist/style.css';
import './index.css';

const root = document.querySelector('#root');

ReactDOM.createRoot(root).render(
  <React.StrictMode>
    {/* React flow needs to be inside an element with a known height and width to work */}
    <div style={{ width: '100vw', height: '100vh' }}>
      <ReactFlowProvider>
        <App />
      </ReactFlowProvider>
    </div>
  </React.StrictMode>,
);
```

è¿™é‡Œæœ‰ä¸‰ä¸ªå…³é”®æ³¨æ„äº‹é¡¹ï¼š

1. å¿…é¡»**å¯¼å…¥ React Flow çš„ CSS æ ·å¼æ–‡ä»¶**ä»¥ç¡®ä¿åŠŸèƒ½æ­£å¸¸
2. React Flow æ¸²æŸ“å™¨éœ€è¦ç½®äºå·²çŸ¥å®½é«˜çš„å®¹å™¨å…ƒç´ å†…ï¼Œå› æ­¤æˆ‘ä»¬å°†å¤–å±‚ `<div />` è®¾ä¸ºå…¨å±å°ºå¯¸
3. è¦ä½¿ç”¨ React Flow æä¾›çš„æŸäº›é’©å­ï¼Œç»„ä»¶å¿…é¡»åŒ…è£¹åœ¨ `<ReactFlowProvider />` å†…æˆ–ç›´æ¥ç½®äº `<ReactFlow />` ç»„ä»¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨ Provider åŒ…è£¹æ•´ä¸ªåº”ç”¨ä»¥ç¡®ä¿å…¼å®¹æ€§

æ¥ä¸‹æ¥ï¼Œæ‰“å¼€ `App.jsx` åˆ›å»ºä¸€ä¸ªç©ºç™½çš„æµç¨‹å›¾ï¼š

```jsx filename="./src/App.jsx"
import React from 'react';
import { ReactFlow, Background } from '@xyflow/react';

export default function App() {
  return (
    <ReactFlow>
      <Background />
    </ReactFlow>
  );
}
```

æˆ‘ä»¬ä¼šé€æ­¥æ‰©å±•å’Œå®Œå–„è¿™ä¸ªç»„ä»¶ã€‚ç›®å‰ï¼Œæˆ‘ä»¬æ·»åŠ äº† React Flow çš„å†…ç½®ç»„ä»¶ [`<Background />`](/api-reference/components/background) æ¥éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ã€‚ç°åœ¨è¿è¡Œ `npm run dev`ï¼ˆå¦‚æœä½ æ²¡æœ‰é€‰æ‹© viteï¼Œè¯·ä½¿ç”¨å¯¹åº”çš„å‘½ä»¤å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼‰ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªç©ºç™½çš„æµç¨‹å›¾ï¼š

<Image
  src="/img/tutorials/webaudio/empty-flow.png"
  alt="Screenshot of an empty React Flow graph"
/>

ä¿æŒå¼€å‘æœåŠ¡å™¨è¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶éšæ—¶æŸ¥çœ‹è¿›åº¦ã€‚

### 1. ä½¿ç”¨ Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†

Zustand å­˜å‚¨å°†ç®¡ç†æˆ‘ä»¬åº”ç”¨çš„æ‰€æœ‰ UI çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå°†ä¿å­˜ React Flow å›¾çš„èŠ‚ç‚¹å’Œè¾¹ã€ä¸€äº›å…¶ä»–çŠ¶æ€ï¼Œä»¥åŠç”¨äºæ›´æ–°è¿™äº›çŠ¶æ€çš„è‹¥å¹² _æ“ä½œ_ã€‚

è¦å®ç°ä¸€ä¸ªåŸºæœ¬çš„äº¤äº’å¼ React Flow å›¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸‰ä¸ªæ“ä½œï¼š

1. `onNodesChange` ç”¨äºå¤„ç†èŠ‚ç‚¹çš„ç§»åŠ¨æˆ–åˆ é™¤ã€‚
2. `onEdgesChange` ç”¨äºå¤„ç† _è¾¹_ çš„ç§»åŠ¨æˆ–åˆ é™¤ã€‚
3. `addEdge` ç”¨äºè¿æ¥å›¾ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹ã€‚

ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `store.js`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```js filename="./src/store.js"
import { applyNodeChanges, applyEdgeChanges } from '@xyflow/react';
import { nanoid } from 'nanoid';
import { createWithEqualityFn } from 'zustand/traditional';

export const useStore = createWithEqualityFn((set, get) => ({
  nodes: [],
  edges: [],

  onNodesChange(changes) {
    set({
      nodes: applyNodeChanges(changes, get().nodes),
    });
  },

  onEdgesChange(changes) {
    set({
      edges: applyEdgeChanges(changes, get().edges),
    });
  },

  addEdge(data) {
    const id = nanoid(6);
    const edge = { id, ...data };

    set({ edges: [edge, ...get().edges] });
  },
}));
```

Zustand çš„ä½¿ç”¨æå…¶ç®€å•ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¥æ”¶ `set` å’Œ `get` å‡½æ•°çš„å‡½æ•°ï¼Œè¿”å›åŒ…å«åˆå§‹çŠ¶æ€å’Œæ›´æ–°æ“ä½œçš„å¯¹è±¡ã€‚é€šè¿‡ `set` å‡½æ•°è¿›è¡Œä¸å¯å˜æ›´æ–°ï¼Œ`get` å‡½æ•°åˆ™ç”¨äºè¯»å–å½“å‰çŠ¶æ€â€”â€”è¿™å°±æ˜¯ zustand çš„å…¨éƒ¨æ ¸å¿ƒé€»è¾‘ã€‚

`onNodesChange` å’Œ `onEdgesChange` ä¸­çš„ `changes` å‚æ•°è¡¨ç¤ºèŠ‚ç‚¹æˆ–è¾¹è¢«ç§»åŠ¨/åˆ é™¤ç­‰äº‹ä»¶ã€‚React Flow æä¾›äº†[è¾…åŠ©å‡½æ•°](/api-reference/utils/apply-node-changes)[å·¥å…·](/api-reference/utils/apply-edge-changes)æ¥è‡ªåŠ¨å¤„ç†è¿™äº›å˜æ›´ï¼Œæˆ‘ä»¬åªéœ€ç”¨æ–°èŠ‚ç‚¹æ•°ç»„æ›´æ–°å­˜å‚¨å³å¯ã€‚

å½“ä¸¤ä¸ªèŠ‚ç‚¹å»ºç«‹è¿æ¥æ—¶ï¼Œ`addEdge` å°†è¢«è°ƒç”¨ã€‚å…¶ `data` å‚æ•°_å‡ ä¹_å°±æ˜¯æœ‰æ•ˆçš„è¾¹æ•°æ®ï¼Œä»…ç¼ºå°‘ id å­—æ®µã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ nanoid ç”Ÿæˆ 6 ä½éšæœº ID å¹¶å°†è¾¹æ·»åŠ åˆ°å›¾ä¸­ï¼Œè¿‡ç¨‹éå¸¸ç›´è§‚ã€‚

å›åˆ° `<App />` ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°† React Flow ä¸è¿™äº›æ“ä½œæŒ‚é’©ï¼Œå®ç°å®Œæ•´åŠŸèƒ½ã€‚

```jsx filename="./src/App.jsx" {3,5,7-13,16,20-24}
import React from 'react';
import { ReactFlow, Background } from '@xyflow/react';
import { shallow } from 'zustand/shallow';

import { useStore } from './store';

const selector = (store) => ({
  nodes: store.nodes,
  edges: store.edges,
  onNodesChange: store.onNodesChange,
  onEdgesChange: store.onEdgesChange,
  addEdge: store.addEdge,
});

export default function App() {
  const store = useStore(selector, shallow);

  return (
    <ReactFlow
      nodes={store.nodes}
      edges={store.edges}
      onNodesChange={store.onNodesChange}
      onEdgesChange={store.onEdgesChange}
      onConnect={store.addEdge}
    >
      <Background />
    </ReactFlow>
  );
}
```

å…³äº `selector` çš„ä½œç”¨ï¼šZustand å…è®¸é€šè¿‡é€‰æ‹©å™¨å‡½æ•°ä»å­˜å‚¨ä¸­ç²¾ç¡®æå–æ‰€éœ€çŠ¶æ€ç‰‡æ®µã€‚ç»“åˆ `shallow` ç›¸ç­‰æ€§åˆ¤æ–­å‡½æ•°ï¼Œè¿™æ„å‘³ç€å½“ä¸å…³å¿ƒçš„çŠ¶æ€å˜åŒ–æ—¶é€šå¸¸ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚

ç›®å‰ï¼Œæˆ‘ä»¬çš„å­˜å‚¨è§„æ¨¡è¾ƒå°ï¼Œå®é™…ä¸Šéœ€è¦ä»ä¸­è·å–æ‰€æœ‰å†…å®¹æ¥æ¸²æŸ“ React Flow å›¾å½¢ã€‚ä½†éšç€è§„æ¨¡æ‰©å¤§ï¼Œè¿™ä¸ªé€‰æ‹©å™¨å°†ç¡®ä¿æˆ‘ä»¬ä¸ä¼šé¢‘ç¹åœ°é‡æ–°æ¸²æŸ“_æ‰€æœ‰_å†…å®¹ã€‚

è¿™å°±æ˜¯å®ç°äº¤äº’å¼å›¾å½¢æ‰€éœ€çš„å…¨éƒ¨åŠŸèƒ½ï¼šæˆ‘ä»¬å¯ä»¥ç§»åŠ¨èŠ‚ç‚¹ã€è¿æ¥èŠ‚ç‚¹ä»¥åŠåˆ é™¤èŠ‚ç‚¹ã€‚ä¸ºäº†æ¼”ç¤ºï¼Œ_ä¸´æ—¶_åœ¨å­˜å‚¨ä¸­æ·»åŠ ä¸€äº›è™šæ‹ŸèŠ‚ç‚¹ï¼š

```js filename="./store.jsx" {2-6}
const useStore = createWithEqualityFn((set, get) => ({
  nodes: [
    { id: 'a', data: { label: 'oscillator' }, position: { x: 0, y: 0 } },
    { id: 'b', data: { label: 'gain' }, position: { x: 50, y: 50 } },
    { id: 'c', data: { label: 'output' }, position: { x: -50, y: 100 } }
  ],
  ...
}));
```

<RemoteCodeViewer route="tutorials/webaudio/state-management" framework="react" />

### 2. è‡ªå®šä¹‰èŠ‚ç‚¹

å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå¯ä»¥å¼€å§‹æ“ä½œçš„äº¤äº’å¼ React Flow å®ä¾‹ã€‚è™½ç„¶æ·»åŠ äº†ä¸€äº›è™šæ‹ŸèŠ‚ç‚¹ï¼Œä½†å®ƒä»¬ç›®å‰åªæ˜¯é»˜è®¤çš„æ— æ ·å¼èŠ‚ç‚¹ã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸‰ä¸ªå¸¦æœ‰äº¤äº’æ§ä»¶çš„è‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

1. ä¸€ä¸ªæŒ¯è¡å™¨èŠ‚ç‚¹ï¼ŒåŒ…å«éŸ³é«˜å’Œæ³¢å½¢ç±»å‹çš„æ§ä»¶ã€‚
2. ä¸€ä¸ªå¢ç›ŠèŠ‚ç‚¹ï¼ŒåŒ…å«éŸ³é‡æ§åˆ¶ã€‚
3. ä¸€ä¸ªè¾“å‡ºèŠ‚ç‚¹ï¼ŒåŒ…å«ä¸€ä¸ªå¼€å…³éŸ³é¢‘å¤„ç†çš„æŒ‰é’®ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ `nodes/`ï¼Œå¹¶ä¸ºæ¯ä¸ªè¦åˆ›å»ºçš„è‡ªå®šä¹‰èŠ‚ç‚¹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ã€‚ä»æŒ¯è¡å™¨å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ§ä»¶å’Œä¸€ä¸ªæºå¥æŸ„ï¼Œç”¨äºå°†æŒ¯è¡å™¨çš„è¾“å‡ºè¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚

```jsx filename="./src/nodes/Osc.jsx"
import React from 'react';
import { Handle } from '@xyflow/react';

import { useStore } from '../store';

export default function Osc({ id, data }) {
  return (
    <div>
      <div>
        <p>Oscillator Node</p>

        <label>
          <span>Frequency</span>
          <input
            className="nodrag"
            type="range"
            min="10"
            max="1000"
            value={data.frequency} />
          <span>{data.frequency}Hz</span>
        </label>

        <label>
          <span>Waveform</span>
          <select className="nodrag" value={data.type}>
            <option value="sine">sine</option>
            <option value="triangle">triangle</option>
            <option value="sawtooth">sawtooth</option>
            <option value="square">square</option>
          </select>
      </div>

      <Handle type="source" position="bottom" />
    </div>
  );
};
```

<Callout type="info">
"nodrag" éå¸¸é‡è¦ã€‚

è¯·æ³¨æ„ `"nodrag"` ç±»è¢«åŒæ—¶æ·»åŠ åˆ° `<input />` å’Œ `<select />` å…ƒç´ ä¸Šã€‚_æå…¶é‡è¦_çš„æ˜¯å¿…é¡»è®°ä½æ·»åŠ è¿™ä¸ªç±»ï¼Œå¦åˆ™ React Flow ä¼šæ‹¦æˆªé¼ æ ‡äº‹ä»¶ï¼Œå¯¼è‡´ä½ åªèƒ½ä¸åœåœ°æ‹–åŠ¨èŠ‚ç‚¹ï¼

</Callout>

å¦‚æœæˆ‘ä»¬å°è¯•æ¸²æŸ“è¿™ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œä¼šå‘ç°è¾“å…¥æ¡†æ²¡æœ‰ä»»ä½•ååº”ã€‚
è¿™æ˜¯å› ä¸ºè¾“å…¥å€¼è¢« `data.frequency` å’Œ `data.type` å›ºå®šäº†ï¼Œè€Œæˆ‘ä»¬æ—¢æ²¡æœ‰ç›‘å¬å˜åŒ–çš„äº‹ä»¶å¤„ç†å™¨ï¼Œä¹Ÿæ²¡æœ‰æ›´æ–°èŠ‚ç‚¹æ•°æ®çš„æœºåˆ¶ï¼

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å›åˆ° store å¹¶æ·»åŠ ä¸€ä¸ª `updateNode` åŠ¨ä½œï¼š

```js filename="./src/store.js"
export const useStore = createWithEqualityFn((set, get) => ({
  ...

  updateNode(id, data) {
    set({
      nodes: get().nodes.map(node =>
        node.id === id
          ? { ...node, data: { ...node.data, ...data } }
          : node
      )
    });
  },

  ...
}));
```

è¿™ä¸ªåŠ¨ä½œå°†å¤„ç†éƒ¨åˆ†æ•°æ®æ›´æ–°ï¼Œä¾‹å¦‚å¦‚æœæˆ‘ä»¬åªæƒ³æ›´æ–°èŠ‚ç‚¹çš„ `frequency`ï¼Œåªéœ€è°ƒç”¨ `updateNode(id, { frequency: 220 }`ã€‚
ç°åœ¨åªéœ€å°†è¿™ä¸ªåŠ¨ä½œå¼•å…¥ `<Osc />` ç»„ä»¶ï¼Œå¹¶åœ¨è¾“å…¥å˜åŒ–æ—¶è°ƒç”¨å®ƒã€‚

```jsx filename="./src/nodes/Osc.jsx" {3,7-10,13,28,35}
import React from 'react';
import { Handle } from '@xyflow/react';
import { shallow } from 'zustand/shallow';

import { useStore } from '../store';

const selector = (id) => (store) => ({
  setFrequency: (e) => store.updateNode(id, { frequency: +e.target.value }),
  setType: (e) => store.updateNode(id, { type: e.target.value }),
});

export default function Osc({ id, data }) {
  const { setFrequency, setType } = useStore(selector(id), shallow);

  return (
    <div>
      <div>
        <p>Oscillator Node</p>

        <label>
          <span>Frequency:</span>
          <input
            className="nodrag"
            type="range"
            min="10"
            max="1000"
            value={data.frequency}
            onChange={setFrequency}
          />
          <span>{data.frequency}Hz</span>
        </label>

        <label>
          <span>Waveform:</span>
          <select className="nodrag" value={data.type} onChange={setType}>
            <option value="sine">sine</option>
            <option value="triangle">triangle</option>
            <option value="sawtooth">sawtooth</option>
            <option value="square">square</option>
          </select>
        </label>
      </div>

      <Handle type="source" position="bottom" />
    </div>
  );
}
```

çœ‹ï¼Œé‚£ä¸ª `selector` åˆå‡ºç°äº†ï¼æ³¨æ„è¿™æ¬¡æˆ‘ä»¬ç”¨å®ƒä»é€šç”¨çš„ `updateNode` åŠ¨ä½œæ´¾ç”Ÿå‡ºä¸¤ä¸ªäº‹ä»¶å¤„ç†å™¨ï¼š`setFrequency` å’Œ `setType`ã€‚

æœ€åçš„å…³é”®æ˜¯å‘Šè¯‰ React Flow å¦‚ä½•æ¸²æŸ“æˆ‘ä»¬çš„è‡ªå®šä¹‰èŠ‚ç‚¹ã€‚ä¸ºæ­¤éœ€è¦åˆ›å»ºä¸€ä¸ª `nodeTypes` å¯¹è±¡ï¼šå…¶é”®åå¯¹åº”èŠ‚ç‚¹çš„ `type` å±æ€§ï¼Œå€¼åˆ™æ˜¯è¦æ¸²æŸ“çš„ React ç»„ä»¶ã€‚

```jsx filename="./src/App.jsx" {5,16-18,26}
import React from 'react';
import { ReactFlow } from '@xyflow/react';
import { shallow } from 'zustand/shallow';

import { useStore } from './store';
import Osc from './nodes/Osc';

const selector = (store) => ({
  nodes: store.nodes,
  edges: store.edges,
  onNodesChange: store.onNodesChange,
  onEdgesChange: store.onEdgesChange,
  addEdge: store.addEdge,
});

const nodeTypes = {
  osc: Osc,
};

export default function App() {
  const store = useStore(selector, shallow);

  return (
    <ReactFlow
      nodes={store.nodes}
      nodeTypes={nodeTypes}
      edges={store.edges}
      onNodesChange={store.onNodesChange}
      onEdgesChange={store.onEdgesChange}
      onConnect={store.addEdge}
    >
      <Background />
    </ReactFlow>
  );
}
```

<Callout type="info">
é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚

é‡è¦æç¤ºï¼šåº”åœ¨ `<App />` ç»„ä»¶å¤–éƒ¨å®šä¹‰ `nodeTypes`ï¼ˆæˆ–ä½¿ç”¨ React çš„ [`useMemo`](https://react.dev/reference/react/useMemo)ï¼‰ï¼Œä»¥é¿å…æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®—ã€‚

</Callout>

å¦‚æœå¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œçœ‹åˆ°ç•Œé¢å°šæœªå˜åŒ–æ—¶è¯·ä¸è¦æƒŠæ…Œï¼
å› ä¸ºæˆ‘ä»¬å°šæœªä¸ºä¸´æ—¶èŠ‚ç‚¹æŒ‡å®šæ­£ç¡®çš„ç±»å‹ï¼ŒReact Flow ä¼šé»˜è®¤å›é€€åˆ°åŸºç¡€èŠ‚ç‚¹æ¸²æŸ“ã€‚åªè¦å°†ä»»æ„èŠ‚ç‚¹ç±»å‹æ”¹ä¸º `osc` å¹¶è®¾ç½® `frequency` å’Œ `type` çš„åˆå§‹å€¼ï¼Œå°±èƒ½çœ‹åˆ°è‡ªå®šä¹‰èŠ‚ç‚¹æ­£å¸¸æ¸²æŸ“äº†ã€‚

```js title"./src/store.js"
const useStore = createWithEqualityFn((set, get) => ({
  nodes: [
    { type: 'osc',
      id: 'a',
      data: { frequency: 220, type: 'square' },
      position: { x: 0, y: 0 }
    },
    ...
  ],
  ...
}));
```

<RemoteCodeViewer
    route="tutorials/webaudio/custom-node"
    framework="react"
    
  />

<Callout type="info">
é‡åˆ°æ ·å¼é—®é¢˜ï¼Ÿ

å¦‚æœæŒ‰ç…§æœ¬æ–‡é€æ­¥å®ç°ä»£ç ï¼Œä½ ä¼šå‘ç°è‡ªå®šä¹‰èŠ‚ç‚¹ä¸ä¸Šæ–¹é¢„è§ˆæ•ˆæœä¸åŒã€‚ä¸ºä¿æŒå†…å®¹ç®€æ´ï¼Œæˆ‘ä»¬çœç•¥äº†ä»£ç ç‰‡æ®µä¸­çš„æ ·å¼éƒ¨åˆ†ã€‚

è¦äº†è§£å¦‚ä½•è®¾è®¡è‡ªå®šä¹‰èŠ‚ç‚¹æ ·å¼ï¼Œè¯·æŸ¥é˜…[ä¸»é¢˜å®šåˆ¶æ–‡æ¡£](/learn/customization/theming)æˆ–å‚è€ƒ[ä½¿ç”¨Tailwindçš„ç¤ºä¾‹](/examples/styling/tailwind)ã€‚

</Callout>

å®ç°å¢ç›ŠèŠ‚ç‚¹çš„è¿‡ç¨‹å‡ ä¹ç›¸åŒï¼Œè¿™éƒ¨åˆ†å°†ç•™ä½œç»ƒä¹ ã€‚ç°åœ¨æˆ‘ä»¬æŠŠæ³¨æ„åŠ›è½¬å‘è¾“å‡ºèŠ‚ç‚¹â€”â€”è¿™ä¸ªèŠ‚ç‚¹ä¸éœ€è¦å‚æ•°æ§ä»¶ï¼Œä½†éœ€è¦å®ç°ä¿¡å·å¤„ç†çš„å¼€å…³åˆ‡æ¢ã€‚ç”±äºå°šæœªç¼–å†™éŸ³é¢‘ç›¸å…³ä»£ç ï¼Œç›®å‰æˆ‘ä»¬æš‚æ—¶åœ¨çŠ¶æ€åº“ä¸­æ·»åŠ ä¸€ä¸ªæ ‡å¿—ä½å’Œå¯¹åº”çš„åˆ‡æ¢åŠ¨ä½œã€‚

```js filename="./src/store.js"
const useStore = createWithEqualityFn((set, get) => ({
  ...

  isRunning: false,

  toggleAudio() {
    set({ isRunning: !get().isRunning });
  },

  ...
}));
```

è‡ªå®šä¹‰èŠ‚ç‚¹æœ¬èº«çš„å®ç°éå¸¸ç®€å•ï¼š

```jsx filename="./src/nodes/Out.jsx"
import React from 'react';
import { Handle } from '@xyflow/react';
import { shallow } from 'zustand/shallow';
import { useStore } from '../store';

const selector = (store) => ({
  isRunning: store.isRunning,
  toggleAudio: store.toggleAudio,
});

export default function Out({ id, data }) {
  const { isRunning, toggleAudio } = useStore(selector, shallow);

  return (
    <div>
      <Handle type="target" position="top" />

      <div>
        <p>Output Node</p>

        <button onClick={toggleAudio}>
          {isRunning ? (
            <span role="img" aria-label="mute">
              ğŸ”‡
            </span>
          ) : (
            <span role="img" aria-label="unmute">
              ğŸ”ˆ
            </span>
          )}
        </button>
      </div>
    </div>
  );
}
```

ç°åœ¨æ•´ä½“å·²ç»åˆå…·é›å½¢ï¼

<RemoteCodeViewer
  route="tutorials/webaudio/custom-nodes"
  framework="react"
  
/>

æ¥ä¸‹æ¥éœ€è¦...

## å®ç°éŸ³é¢‘å¤„ç†

æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªäº¤äº’å¼å›¾è¡¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ›´æ–°èŠ‚ç‚¹æ•°æ®ï¼Œç°åœ¨è®©æˆ‘ä»¬åŠ å…¥å…³äº Web Audio API çš„çŸ¥è¯†ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `audio.js`ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„éŸ³é¢‘ä¸Šä¸‹æ–‡å’Œä¸€ä¸ªç©ºçš„ `Map`ã€‚

```js filename="./src/audio.js"
const context = new AudioContext();
const nodes = new Map();
```

æˆ‘ä»¬å°†é€šè¿‡æŒ‚é’©åˆ°å­˜å‚¨ä¸­çš„ä¸åŒæ“ä½œæ¥ç®¡ç†éŸ³é¢‘å›¾ã€‚ä¾‹å¦‚å½“è°ƒç”¨ `addEdge` æ“ä½œæ—¶è¿æ¥ä¸¤ä¸ªéŸ³é¢‘èŠ‚ç‚¹ï¼Œæˆ–åœ¨è°ƒç”¨ `updateNode` æ—¶æ›´æ–°éŸ³é¢‘èŠ‚ç‚¹çš„å±æ€§ï¼Œä»¥æ­¤ç±»æ¨ã€‚

<Callout type="warning">
ç¡¬ç¼–ç èŠ‚ç‚¹

æœ¬æ–‡å‰é¢éƒ¨åˆ†æˆ‘ä»¬åœ¨å­˜å‚¨ä¸­ç¡¬ç¼–ç äº†å‡ ä¸ªèŠ‚ç‚¹ï¼Œä½†éŸ³é¢‘å›¾å¯¹è¿™äº›èŠ‚ç‚¹ä¸€æ— æ‰€çŸ¥ï¼åœ¨æœ€ç»ˆé¡¹ç›®ä¸­æˆ‘ä»¬å¯ä»¥å»é™¤æ‰€æœ‰è¿™äº›ç¡¬ç¼–ç éƒ¨åˆ†ï¼Œä½†ç›®å‰**éå¸¸å…³é”®**çš„æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦ç¡¬ç¼–ç ä¸€äº›éŸ³é¢‘èŠ‚ç‚¹ã€‚

å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```js filename="./src/audio.js" {4-7,9-10,12,14-16}
const context = new AudioContext();
const nodes = new Map();

const osc = context.createOscillator();
osc.frequency.value = 220;
osc.type = 'square';
osc.start();

const amp = context.createGain();
amp.gain.value = 0.5;

const out = context.destination;

nodes.set('a', osc);
nodes.set('b', amp);
nodes.set('c', out);
```

</Callout>

### 1. èŠ‚ç‚¹å˜æ›´

å½“å‰å›¾è¡¨ä¸­å¯èƒ½å‘ç”Ÿä¸¤ç±»éœ€è¦å“åº”çš„èŠ‚ç‚¹å˜æ›´ï¼šæ›´æ–°èŠ‚ç‚¹çš„ `data` å±æ€§ï¼Œä»¥åŠä»å›¾è¡¨ä¸­ç§»é™¤èŠ‚ç‚¹ã€‚æˆ‘ä»¬å·²ç»ä¸ºå‰è€…å‡†å¤‡äº†æ“ä½œï¼Œè®©æˆ‘ä»¬å…ˆå¤„ç†è¿™ä¸ªåœºæ™¯ã€‚

åœ¨ `audio.js` æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªåä¸º `updateAudioNode` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°é€šè¿‡ä¼ å…¥èŠ‚ç‚¹ ID å’Œéƒ¨åˆ† `data` å¯¹è±¡æ¥æ›´æ–° `Map` ä¸­ç°æœ‰çš„èŠ‚ç‚¹ï¼š

```js filename="./src/audio.js"
export function updateAudioNode(id, data) {
  const node = nodes.get(id);

  for (const [key, val] of Object.entries(data)) {
    if (node[key] instanceof AudioParam) {
      node[key].value = val;
    } else {
      node[key] = val;
    }
  }
}
```

<Callout type="info">
  è¯·æ³¨æ„éŸ³é¢‘èŠ‚ç‚¹ä¸Šçš„å±æ€§å¯èƒ½æ˜¯ç‰¹æ®Šçš„ `AudioParam` ç±»å‹ï¼Œå¿…é¡»é‡‡ç”¨ä¸å¸¸è§„å¯¹è±¡å±æ€§ä¸åŒçš„æ›´æ–°æ–¹å¼ã€‚
</Callout>

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ›´æ–° store ä¸­çš„ `updateNode` æ“ä½œï¼Œä½¿å…¶åœ¨æ›´æ–°è¿‡ç¨‹ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š

```js filename="./src/store.js"
import { updateAudioNode } from './audio';

export const useStore = createWithEqualityFn((set, get) => ({
  ...

  updateNode(id, data) {
    updateAudioNode(id, data);
    set({ nodes: ... });
  },

  ...
}));

```

æˆ‘ä»¬éœ€è¦å¤„ç†çš„å¦ä¸€ä¸ªå˜æ›´æ˜¯ä»å›¾ä¸­ç§»é™¤èŠ‚ç‚¹ã€‚å¦‚æœåœ¨å›¾ä¸­é€‰ä¸­èŠ‚ç‚¹å¹¶æŒ‰é€€æ ¼é”®ï¼ŒReact Flow ä¼šå°†å…¶ç§»é™¤ã€‚è™½ç„¶æˆ‘ä»¬å·²è¿æ¥çš„ `onNodesChange` æ“ä½œä¼šéšå¼å¤„ç†è¿™ä¸€è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä»¬éœ€è¦é¢å¤–å¤„ç†é€»è¾‘ï¼Œå› æ­¤éœ€è¦ä¸º React Flow çš„ `onNodesDelete` äº‹ä»¶é…ç½®æ–°æ“ä½œã€‚

è¿™ä¸ªå®ç°å…¶å®ç›¸å½“ç®€å•ï¼Œä¸ºèŠ‚çœé˜…è¯»æ—¶é—´ï¼Œæˆ‘å°†ç›´æ¥å±•ç¤ºæ¥ä¸‹æ¥çš„ä¸‰æ®µä»£ç è€Œä¸ä½œè¯´æ˜ã€‚

<Tabs items={['./src/audio.js', './src/store.js', './src/App.jsx']}>
  <Tabs.Tab>

```js
export function removeAudioNode(id) {
  const node = nodes.get(id);

  node.disconnect();
  node.stop?.();

  nodes.delete(id);
}
```

  </Tabs.Tab>
  <Tabs.Tab>

```js
import { ..., removeAudioNode } from './audio';

export const useStore = createWithEqualityFn((set, get) => ({
  ...

  removeNodes(nodes) {
    for (const { id } of nodes) {
      removeAudioNode(id)
    }
  },

  ...
}));
```

  </Tabs.Tab>
  <Tabs.Tab>

```jsx
const selector = store => ({
  ...,
  onNodesDelete: store.removeNodes
});

export default function App() {
  const store = useStore(selector, shallow);

  return (
    <ReactFlow
      onNodesDelete={store.onNodesDelete}
      ...
    >
      <Background />
    </ReactFlow>
  )
};
```

  </Tabs.Tab>
</Tabs>

å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼š`onNodesDelete` ä¼šä»¥_æ•°ç»„_å½¢å¼å‘å›è°ƒå‡½æ•°ä¼ é€’è¢«åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå› ä¸ºå¯èƒ½åŒæ—¶åˆ é™¤å¤šä¸ªèŠ‚ç‚¹ï¼

### 2. è¾¹å˜æ›´å¤„ç†

æˆ‘ä»¬ç¦»å®é™…å‘å‡ºå£°éŸ³å·²ç»éå¸¸æ¥è¿‘äº†ï¼æœ€ååªéœ€å¤„ç†å›¾ä¸­è¾¹çš„å˜æ›´ã€‚ä¸èŠ‚ç‚¹å˜æ›´ç±»ä¼¼ï¼Œæˆ‘ä»¬å·²ç»å…·å¤‡åˆ›å»ºæ–°è¾¹çš„æ“ä½œï¼ŒåŒæ—¶ `onEdgesChange` ä¹Ÿä¼šéšå¼å¤„ç†è¢«ç§»é™¤çš„è¾¹ã€‚

è¦å¤„ç†æ–°è¿æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä»`addEdge`æ“ä½œåˆ›å»ºçš„è¾¹ä¸­è·å–`source`å’Œ`target`çš„idã€‚ç„¶åå°±å¯ä»¥åœ¨`Map`ä¸­æŸ¥æ‰¾è¿™ä¸¤ä¸ªèŠ‚ç‚¹å¹¶å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚

<Tabs items={["./src/audio.js", "./src/store.js"]}>
  <Tabs.Tab>

```js
export function connect(sourceId, targetId) {
  const source = nodes.get(sourceId);
  const target = nodes.get(targetId);

  source.connect(target);
}
```

  </Tabs.Tab>
  <Tabs.Tab>

```js
import { ..., connect } from './audio';

export const useStore = createWithEqualityFn((set, get) => ({
  ...

  addEdge(data) {
    ...

    connect(data.source, data.target);
  },

  ...
}));
```

  </Tabs.Tab>
</Tabs>

æˆ‘ä»¬å·²ç»çœ‹åˆ°React Flowæ¥å—`onNodesDelete`å¤„ç†ç¨‹åºï¼Œä¸å‡ºæ‰€æ–™ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ª`onEdgesDelete`å¤„ç†ç¨‹åºï¼å®ç°`disconnect`å¹¶å°†å…¶è¿æ¥åˆ°æˆ‘ä»¬çš„å­˜å‚¨å’ŒReact Flowå®ä¾‹çš„æ–¹æ³•ä¸ä¹‹å‰åŸºæœ¬ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°†è¿™éƒ¨åˆ†ç•™ç»™ä½ æ¥å®Œæˆï¼

### 3. å¼€å¯æ‰¬å£°å™¨

ä½ å¯èƒ½è¿˜è®°å¾—ï¼Œæˆ‘ä»¬çš„`AudioContext`å¯èƒ½ä¸€å¼€å§‹å¤„äºæš‚åœçŠ¶æ€ï¼Œä»¥é˜²æ­¢å¯èƒ½ä»¤äººè®¨åŒçš„è‡ªåŠ¨æ’­æ”¾é—®é¢˜ã€‚æˆ‘ä»¬å·²ç»åœ¨å­˜å‚¨ä¸­ä¸º`<Out />`ç»„ä»¶æ¨¡æ‹Ÿäº†æ‰€éœ€çš„æ•°æ®å’Œæ“ä½œï¼Œç°åœ¨åªéœ€è¦ç”¨çœŸå®ä¸Šä¸‹æ–‡çš„çŠ¶æ€å’Œæ¢å¤/æš‚åœæ–¹æ³•æ¥æ›¿æ¢å®ƒä»¬ã€‚

```js filename="./src/audio.js"
export function isRunning() {
  return context.state === 'running';
}

export function toggleAudio() {
  return isRunning() ? context.suspend() : context.resume();
}
```

è™½ç„¶åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„éŸ³é¢‘å‡½æ•°è¿˜æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ï¼Œä½†æˆ‘ä»¬éœ€è¦ä»`toggleAudio`è¿”å›ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿‡æ—©åœ°æ›´æ–°å­˜å‚¨ï¼

```js filename="./src/store.js"
import { ..., isRunning, toggleAudio } from './audio'

export const useStore = createWithEqualityFn((set, get) => ({
  ...

  isRunning: isRunning(),

  toggleAudio() {
    toggleAudio().then(() => {
      set({ isRunning: isRunning() });
    });
  }
}));
```

ç§ï¼Œæˆ‘ä»¬åšåˆ°äº†ï¼æˆ‘ä»¬ç°åœ¨å·²ç»æ•´åˆäº†è¶³å¤Ÿçš„å†…å®¹æ¥çœŸæ­£_å‘å‡ºå£°éŸ³_ï¼è®©æˆ‘ä»¬çœ‹çœ‹å®é™…æ•ˆæœå¦‚ä½•ã€‚

<RemoteCodeViewer
  route="tutorials/webaudio/hardcoded-audio"
  framework="react"
  
/>

### 4. åˆ›å»ºæ–°èŠ‚ç‚¹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¤„ç†å›¾ä¸­ç¡¬ç¼–ç çš„èŠ‚ç‚¹é›†åˆã€‚è¿™å¯¹äºåŸå‹è®¾è®¡æ¥è¯´å·²ç»è¶³å¤Ÿï¼Œä½†è¦è®©å…¶çœŸæ­£å®ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§åŠ¨æ€æ·»åŠ æ–°èŠ‚ç‚¹çš„æ–¹æ³•ã€‚æœ€ç»ˆä»»åŠ¡å°±æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½ï¼šæˆ‘ä»¬å°†ä»éŸ³é¢‘ä»£ç å¼€å§‹é€†å‘æ“ä½œï¼Œæœ€ç»ˆåˆ›å»ºä¸€ä¸ªåŸºç¡€å·¥å…·æ ã€‚

å®ç°`createAudioNode`å‡½æ•°éå¸¸ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦æ–°èŠ‚ç‚¹çš„IDã€è¦åˆ›å»ºçš„èŠ‚ç‚¹ç±»å‹åŠå…¶åˆå§‹æ•°æ®ï¼š

```js filename="./src/audio.js"
export function createAudioNode(id, type, data) {
  switch (type) {
    case 'osc': {
      const node = context.createOscillator();
      node.frequency.value = data.frequency;
      node.type = data.type;
      node.start();

      nodes.set(id, node);
      break;
    }

    case 'amp': {
      const node = context.createGain();
      node.gain.value = data.gain;

      nodes.set(id, node);
      break;
    }
  }
}
```

æ¥ä¸‹æ¥éœ€è¦åœ¨storeä¸­åˆ›å»º`createNode`å‡½æ•°ã€‚èŠ‚ç‚¹IDå°†ç”±nanoidç”Ÿæˆï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ç§èŠ‚ç‚¹ç±»å‹ç¡¬ç¼–ç ä¸€äº›åˆå§‹æ•°æ®ï¼Œå› æ­¤å”¯ä¸€éœ€è¦ä¼ å…¥çš„å‚æ•°å°±æ˜¯è¦åˆ›å»ºçš„èŠ‚ç‚¹ç±»å‹ï¼š

```js filename="./src/store.js"
import { ..., createAudioNode } from './audio';

export const useStore = createWithEqualityFn((set, get) => ({
  ...

  createNode(type) {
    const id = nanoid();

    switch(type) {
      case 'osc': {
        const data = { frequency: 440, type: 'sine' };
        const position = { x: 0, y: 0 };

        createAudioNode(id, type, data);
        set({ nodes: [...get().nodes, { id, type, data, position }] });

        break;
      }

      case 'amp': {
        const data = { gain: 0.5 };
        const position = { x: 0, y: 0 };

        createAudioNode(id, type, data);
        set({ nodes: [...get().nodes, { id, type, data, position }] });

        break;
      }
    }
  }
}));
```

æœ¬å¯ä»¥æ›´æ™ºèƒ½åœ°è®¡ç®—æ–°èŠ‚ç‚¹çš„ä½ç½®ï¼Œä½†ä¸ºäº†ä¿æŒç®€å•ï¼Œæˆ‘ä»¬æš‚æ—¶å°†å…¶ç¡¬ç¼–ç ä¸º`{ x: 0, y: 0 }`ã€‚

æœ€åçš„å…³é”®æ˜¯åˆ›å»ºä¸€ä¸ªèƒ½è§¦å‘`createNode`æ“ä½œçš„å·¥å…·æ ç»„ä»¶ã€‚ä¸ºæ­¤æˆ‘ä»¬å°†å›åˆ°`App.jsx`ï¼Œä½¿ç”¨å†…ç½®çš„[`<Panel />`](/docs//api-reference/components/panel/)ç»„ä»¶ã€‚

```jsx filename="./src/App.jsx"
...
import {Â ReactFlow,  Panel } from '@xyflow/react';
...

const selector = (store) => ({
  ...,
  createNode: store.createNode,
});

export default function App() {
  const store = useStore(selector, shallow);

  return (
    <ReactFlow>
      <Panel position="top-right">
        ...
      </Panel>
      <Background />
    </ReactFlow>
  );
};
```

è¿™é‡Œä¸éœ€è¦å¤æ‚åŠŸèƒ½ï¼Œåªéœ€å‡ ä¸ªæŒ‰é’®æ¥è§¦å‘å¸¦æœ‰ç›¸åº”èŠ‚ç‚¹ç±»å‹çš„`createNode`æ“ä½œï¼š

```jsx filename="./src/App.jsx"
<Panel position="top-right">
  <button onClick={() => store.createNode('osc')}>osc</button>
  <button onClick={() => store.createNode('amp')}>amp</button>
</Panel>
```

è‡³æ­¤...å¤§åŠŸå‘Šæˆï¼æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„éŸ³é¢‘å›¾ç¼–è¾‘å™¨ï¼Œèƒ½å¤Ÿï¼š

- åˆ›å»ºæ–°çš„éŸ³é¢‘èŠ‚ç‚¹
- é€šè¿‡UIæ§ä»¶æ›´æ–°èŠ‚ç‚¹æ•°æ®  
- è¿æ¥èŠ‚ç‚¹  
- åˆ é™¤èŠ‚ç‚¹å’Œè¿æ¥  
- å¯åŠ¨/åœæ­¢éŸ³é¢‘å¤„ç†

è¿™æ˜¯å¼€å¤´çš„æ¼”ç¤ºï¼Œä½†è¿™æ¬¡ä½ å¯ä»¥æŸ¥çœ‹æºä»£ç ä»¥ç¡®ä¿æ²¡æœ‰é—æ¼ä»»ä½•å†…å®¹ã€‚

<RemoteCodeViewer route="tutorials/webaudio/demo" framework="react" />

## æœ€ç»ˆæ€è€ƒ

å‘¼â€”â€”è¿™ç¯‡å†…å®¹å¾ˆé•¿ï¼Œä½†æˆ‘ä»¬å®Œæˆäº†ï¼é€šè¿‡åŠªåŠ›ï¼Œæˆ‘ä»¬æ”¶è·äº†ä¸€ä¸ªæœ‰è¶£çš„äº¤äº’å¼éŸ³é¢‘å®éªŒåœºï¼Œè¿‡ç¨‹ä¸­å­¦ä¹ äº†Web Audio APIçš„ç›¸å…³çŸ¥è¯†ï¼Œä¹Ÿå¯¹"è¿è¡Œ"React Flowå›¾è¡¨çš„å®ç°æ–¹å¼æœ‰äº†æ›´æ·±ç†è§£ã€‚

å¦‚æœä½ çœ‹åˆ°è¿™é‡Œå¹¶åœ¨æƒ³ï¼š"Hayleighï¼Œæˆ‘æ ¹æœ¬ä¸ä¼šå¼€å‘Web Audioåº”ç”¨ï¼Œè¿™äº›å†…å®¹æœ‰ç”¨å—ï¼Ÿ"é‚£ä¹ˆä½ å¾ˆå¹¸è¿â€”â€”ç¡®å®æœ‰ç”¨ï¼ä½ å¯ä»¥å°†æˆ‘ä»¬è¿æ¥Web Audio APIçš„æ–¹æ³•åº”ç”¨åˆ°å…¶ä»–åŸºäºå›¾çš„è®¡ç®—å¼•æ“ï¼ˆå¦‚[behave-graph](https://github.com/bhouston/behave-graph)ï¼‰ã€‚äº‹å®ä¸Šï¼Œæœ‰äººå·²ç»è¿™ä¹ˆåšäº†å¹¶åˆ›å»ºäº†[behave-flow](https://github.com/beeglebug/behave-flow)ï¼

è¿™ä¸ªé¡¹ç›®è¿˜æœ‰å¾ˆå¤šæ‰©å±•æ–¹å‘ã€‚å¦‚æœä½ æƒ³ç»§ç»­å®Œå–„ï¼Œè¿™é‡Œæœ‰äº›å»ºè®®ï¼š

- æ·»åŠ æ›´å¤šèŠ‚ç‚¹ç±»å‹  
- å…è®¸èŠ‚ç‚¹è¿æ¥åˆ°å…¶ä»–èŠ‚ç‚¹çš„`AudioParams`  
- ä½¿ç”¨[`AnalyserNode`](https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode)å¯è§†åŒ–èŠ‚ç‚¹æˆ–ä¿¡å·è¾“å‡º  
- ä»»ä½•ä½ èƒ½æƒ³åˆ°çš„åŠŸèƒ½ï¼

å¦‚æœä½ æ­£åœ¨å¯»æ‰¾çµæ„Ÿï¼Œå¸‚é¢ä¸Šæœ‰ä¸å°‘é¡¹ç›®é‡‡ç”¨äº†åŸºäºèŠ‚ç‚¹çš„ç”¨æˆ·ç•Œé¢æ¥å¤„ç†éŸ³é¢‘ç›¸å…³åŠŸèƒ½ã€‚æˆ‘ä¸ªäººæœ€å–œæ¬¢çš„å‡ ä¸ªåŒ…æ‹¬ [Max/MSP](https://cycling74.com/products/max/)ã€[Reaktor](https://www.native-instruments.com/en/products/komplete/synths/reaktor-6/) å’Œ [Pure Data](https://puredata.info/)ã€‚å…¶ä¸­ Max å’Œ Reaktor æ˜¯é—­æºçš„å•†ä¸šè½¯ä»¶ï¼Œä½†ä½ ä¾ç„¶å¯ä»¥ä»ä¸­å€Ÿé‰´ä¸€äº›åˆ›æ„æ€è·¯ <Emoji content="ğŸ•µï¸" />ã€‚

ä½ å¯ä»¥å°†å®Œæ•´çš„[æºä»£ç ](https://github.com/xyflow/react-flow-web-audio)ä½œä¸ºèµ·ç‚¹ï¼Œä¹Ÿå¯ä»¥åŸºäºæˆ‘ä»¬ä»Šå¤©æ„å»ºçš„å†…å®¹ç»§ç»­å¼€å‘ã€‚æˆ‘ä»¬éå¸¸æœŸå¾…çœ‹åˆ°ä½ çš„åˆ›ä½œæˆæœï¼Œæ¬¢è¿é€šè¿‡ [Discord æœåŠ¡å™¨](https://discord.com/invite/RVmnytFmGW) æˆ– [Twitter](https://twitter.com/xyflowdev) ä¸æˆ‘ä»¬åˆ†äº«ã€‚

React Flow æ˜¯ä¸€å®¶ç”±ç”¨æˆ·èµ„åŠ©çš„ç‹¬ç«‹å…¬å¸ã€‚å¦‚æœä½ æƒ³æ”¯æŒæˆ‘ä»¬ï¼Œå¯ä»¥é€‰æ‹© [åœ¨ Github èµåŠ©](https://github.com/sponsors/xyflow) æˆ– [è®¢é˜…æˆ‘ä»¬çš„ Pro æ–¹æ¡ˆ](/pro/)ã€‚