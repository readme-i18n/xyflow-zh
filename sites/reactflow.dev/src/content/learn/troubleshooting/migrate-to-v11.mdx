---

sidebarTitle: 迁移至 v11
description: 使用本指南从 React Flow v10 迁移至 v11。
---

# 迁移至 React Flow v11

import { Callout } from 'nextra/components';

<Callout type="info">
  您可以在此处找到旧版 React Flow 的文档：
  [v11](https://v11.reactflow.dev), [v10](https://v10.reactflow.dev),
  [v9](https://v9.reactflow.dev)
</Callout>

v11 版本有许多变化，但这次我们尽量减少了破坏性变更。最大的变化是新的包名 `reactflow` 和新的仓库结构。React Flow 现在采用 monorepo 管理，并拆分为多个可单独安装的包。除此之外，v11 还引入了一些 API 变更和新 API。本指南详细解释了这些变化，帮助您从 v10 迁移至 v11。

<Callout>React Flow 11 仅支持 **React 17** 或更高版本</Callout>

## 新特性

- **更完善的[无障碍访问支持](/learn/advanced-use/accessibility)**
  - 节点和边可通过键盘进行聚焦、选择、移动和删除操作
  - 所有元素默认带有 `aria-` 属性，并可通过 `ariaLabel` 选项控制
  - 新增 `disableKeyboardA11y` 属性可禁用键盘控制功能
- **更优化的边选择体验**：新增 `interactionWidth` 边选项 - 渲染不可见边以提升交互便利性
- **smoothstep 和 step 边的路径优化**：https://twitter.com/reactflowdev/status/1567535405284614145
- **更流畅的边更新行为**：https://twitter.com/reactflowdev/status/1564966917517021184
- **节点原点控制**：新增 `nodeOrigin` 属性可控制节点原点，对布局非常有用
- **新背景图案**：`BackgroundVariant.Cross` 变体
- **[`useOnViewportChange`](/api-reference/hooks/use-on-viewport-change) 钩子** - 在组件内处理视口变化
- **[`use-on-selection-change`](/api-reference/hooks/use-on-selection-change) 钩子** - 在组件内处理选择变化
- **[`useNodesInitialized`](/api-reference/hooks/use-nodes-initialized) 钩子** - 当所有节点初始化完成且存在多个节点时返回 true
- **节点和边的可删除选项**
- **新事件处理器**：`onPaneMouseEnter`、`onPaneMouseMove` 和 `onPaneMouseLeave`
- **边路径选项**：适用于 `smoothstep` 和 `default` 边的 `pathOptions`
- **更合理的默认光标**：拖动节点或平移时显示抓取光标
- **中键平移**：支持使用鼠标中键移动画布
- **不可拖动节点上的平移**（当 `draggable=false` 或 `nodesDraggable` 为 false 时）
  - 可通过在自定义节点包装器添加 `nopan` 类名禁用此行为
- **[`<BaseEdge />`](/api-reference/components/base-edge) 组件** - 简化自定义边的构建过程
- **[可独立安装的包](/learn/concepts/built-in-components)**
  - @reactflow/core
  - @reactflow/background
  - @reactflow/controls
  - @reactflow/minimap

## 重大变更

### 1. 新的 npm 包名称

原包名 `react-flow-renderer` 已更名为 `reactflow`。

#### 旧版 API

```js
// npm install react-flow-renderer
import ReactFlow from 'react-flow-renderer';
```

#### 新版 API

```js
// npm install reactflow
import { ReactFlow } from '@xyflow/react';
```

### 2. 必须导入 CSS

我们不再自动注入 CSS 样式。**若不加载样式表，React Flow 将无法正常工作！**

```js
// default styling
import '@xyflow/react/dist/style.css';

// or if you just want basic styles
import '@xyflow/react/dist/base.css';
```

#### 2.1. 移除 nocss 入口点

此项变更意味着 `react-flow-renderer/nocss` 入口点已被移除。若您曾使用该入口点，请按上述方式调整 CSS 引入方式。

### 3. `defaultPosition` 和 `defaultZoom` 合并为 `defaultViewport`

#### 旧版 API

```jsx
import ReactFlow from 'react-flow-renderer';

const Flow = () => {
  return <ReactFlow defaultPosition={[10, 15]} defaultZoom={5} />;
};

export default Flow;
```

#### 新版 API

```jsx
import { ReactFlow } from '@xyflow/react';

const defaultViewport: Viewport = { x: 10, y: 15, zoom: 5 };

const Flow = () => {
  return <ReactFlow defaultViewport={defaultViewport} />;
};

export default Flow;
```

### 4. 移除 `getBezierEdgeCenter`、`getSimpleBezierEdgeCenter` 和 `getEdgeCenter`

在 v10 版本中，我们提供 `getBezierEdgeCenter`、`getSimpleBezierEdgeCenter` 和 `getEdgeCenter` 来获取特定边的中心点。
v11 版本中我们修改了路径生成辅助函数，使其同时返回边的中心点/标签位置。

假设您需要获取贝塞尔边的路径及其中心点/标签位置：

#### 旧版 API

```jsx
import { getBezierEdgeCenter, getBezierPath } from 'react-flow-renderer';

const path = getBezierPath(edgeParams);
const [centerX, centerY] = getBezierEdgeCenter(params);
```

#### 新版 API

```jsx
import { getBezierPath } from '@xyflow/react';

const [path, labelX, labelY] = getBezierPath(edgeParams);
```

我们不再使用 `centerX` 和 `centerY` 命名，因为该位置实际是标签位置，并非所有边类型的几何中心。

### 5. 移除 `onClickConnectStop` 和 `onConnectStop`

#### 旧版 API

```jsx
import ReactFlow from 'react-flow-renderer';

const Flow = () => {
  const onConnectStop = () => console.log('on connect stop');

  return (
    <ReactFlow
      defaultNodes={defaultNodes}
      defaultEdges={defaultEdges}
      onConnectStop={onConnectStop}
      onClickConnectStop={onConnectStop}
    />
  );
};

export default Flow;
```

#### 新版 API

```jsx
import { ReactFlow } from '@xyflow/react';

const Flow = () => {
  const onConnectEnd = () => console.log('on connect stop');

  return (
    <ReactFlow
      defaultNodes={defaultNodes}
      defaultEdges={defaultEdges}
      onConnectEnd={onConnectEnd}
      onClickConnectEnd={onConnectEnd}
    />
  );
};

export default Flow;
```

### 6. 节点平移行为

在之前的版本中，即使节点不可拖动，也无法平移视图。在 v11 版本中，当 `nodesDraggable=false` 或节点选项 `draggable=false` 时，允许平移视图覆盖节点区域。如需恢复旧版行为，可为自定义节点的包装器添加 `nopan` 类名。